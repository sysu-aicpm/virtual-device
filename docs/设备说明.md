# 设备说明文档

## 通用特性

所有设备都具有以下基本特性：

1. 设备标识
   - `device_id`：全局唯一的设备标识符（UUID格式）
   - `device_type`：设备类型标识

2. 基本状态
   - `power`：当前功耗（单位：瓦特）
   - `status`：设备连接状态（只支持 online/offline/error）
   - `last_update`：最后更新时间

3. 通用功能
   - 心跳包发送（默认每5秒）
   - 状态查询
   - 事件数据（包含在心跳包中）
   - 动态功耗模拟
   - 自动事件生成

## 具体设备说明

### 1. 冰箱（Refrigerator）

**基本信息**
- 设备类型：`refrigerator`
- 默认功耗：100W（动态波动±10%）
- 默认温度：4℃

**特有属性**
- `temperature`：冰箱温度（范围：-20℃ ~ 10℃）
- `door_open`：冰箱门状态（true/false）
- `power_state`：电源状态（"on"/"off"）

**自动行为**
- 每5-15秒有30%概率随机开关冰箱门
- 每5-15秒有20%概率随机温度波动
- 温度越低，功耗越大：功耗 = 100 + (4 - 温度) * 5

**控制命令**
- `set_temperature`：设置冰箱温度
  - 参数：temperature（整数，范围：-20 ~ 10）
  - 示例：设置温度为2℃
- `switch`：开关控制
  - 参数：state（"on"/"off"）
  - 示例：关闭冰箱

### 2. 智能灯（Light）

**基本信息**
- 设备类型：`light`
- 默认功耗：10W（最大，动态波动±10%）
- 默认状态：关闭（brightness = 0）

**特有属性**
- `brightness`：亮度（范围：0-100）
- `power_state`：电源状态（"on"/"off"）
- 功耗随亮度变化：功耗 = 亮度 / 10（瓦特）

**自动行为**
- 每5-15秒有20%概率随机调节亮度
- 亮度改变时自动调整功耗
- 亮度为0时自动关闭

**控制命令**
1. `set_brightness`：调节亮度
   - 参数：brightness（整数，范围：0-100）
   - 影响：改变亮度和功耗
2. `switch`：开关控制
   - 参数：state（"on"/"off"）
   - 影响：开启时亮度100，关闭时亮度0

### 3. 智能门锁（Lock）

**基本信息**
- 设备类型：`lock`
- 默认功耗：5W（动态波动±10%）
- 默认状态：锁定

**特有属性**
- `locked`：锁定状态（true/false）
- `lock_state`：显示为"locked"或"unlocked"
- `battery`：电池电量百分比（0-100）

**自动行为**
- 每5-15秒有15%概率随机切换锁定状态
- 每5-15秒有10%概率电池电量减少
- 锁定/解锁操作消耗电池电量

**控制命令**
- `set_lock`：设置锁定状态
  - 参数：state（"lock"/"unlock"）
  - 影响：改变锁定状态和显示状态

### 4. 智能摄像头（Camera）

**基本信息**
- 设备类型：`camera`
- 默认功耗：15W（待机）/25W（录制）（动态波动±10-20%）
- 默认分辨率：1080p

**特有属性**
- `recording`：录制状态（true/false）
- `resolution`：分辨率（720p/1080p/4k）
- `camera_state`：显示为"recording"或"standby"
- `storage_used`：已使用存储空间（MB）

**自动行为**
- 每5-15秒有25%概率随机开始/停止录制
- 每5-15秒有10%概率随机切换分辨率
- 录制状态改变时自动调整功耗
- 录制时持续增加存储使用量
- 分辨率越高，存储使用速率越快

**控制命令**
1. `set_recording`：控制录制
   - 参数：state（"start"/"stop"）
   - 影响：改变录制状态和功耗
2. `set_resolution`：设置分辨率
   - 参数：resolution（"720p"/"1080p"/"4k"）
   - 影响：改变视频质量和存储使用速率

## 事件说明

每个设备在状态发生变化时，都会在心跳包中包含相关事件数据。心跳包包含以下信息：
- 设备标识（device_identifier）
- 时间戳（timestamp）
- 设备状态（status）：online/offline/error
- 数据（data）：包含动态功耗和设备事件

### 事件数据说明

1. 冰箱事件
   - `door_state_change`：门状态改变
   ```json
   {
       "door_open": true/false
   }
   ```
   - `temperature_change`：温度改变
   ```json
   {
       "temperature": 4.2
   }
   ```
   - `power_state_change`：电源状态改变
   ```json
   {
       "power_state": "on"/"off"
   }
   ```

2. 灯事件
   - `brightness_change`：亮度改变
   ```json
   {
       "brightness": 80
   }
   ```
   - `power_state_change`：电源状态改变
   ```json
   {
       "power_state": "on"/"off"
   }
   ```

3. 门锁事件
   - `lock_state_change`：锁定状态改变
   ```json
   {
       "lock_state": "locked"/"unlocked"
   }
   ```
   - `battery_level`：电池电量
   ```json
   {
       "battery": 95.5
   }
   ```

4. 摄像头事件
   - `camera_state`：录制状态改变
   ```json
   {
       "camera_state": "recording"/"standby"
   }
   ```
   - `resolution_change`：分辨率改变
   ```json
   {
       "resolution": "720p"/"1080p"/"4k"
   }
   ```
   - `storage_usage`：存储使用情况
   ```json
   {
       "storage_used_mb": 250
   }
   ```

## 配置说明

设备的配置通过环境变量或 `.env` 文件进行设置：

```ini
HOST=0.0.0.0              # 服务器监听地址
PORT=5000                 # 服务器端口
CONTROLLER_URL=http://localhost:8000  # 控制器地址
HEARTBEAT_INTERVAL=5      # 心跳间隔（秒）
DEVICE_TYPE=refrigerator  # 设备类型
``` 